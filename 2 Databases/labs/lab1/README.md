# Теория по лабораторной работе №1

## Архитектура ANSI-SPARC

В 1975 году подкомитет **SPARC** (Standards Planning and Requirements Committee) американского национального института стандартов (American National Standards Institute, **ANSI**) выдвинул проект трехуровневой архитектуры СУБД (рис. 1.3):

![[Pasted image 20250304093223.png]]

1. **Внешний** или ещё его называют "пользовательский". На нём  описываются различные подмножества элементов концептуального уровня для представления данных различными пользователями и (или) их программами. Каждый пользователь получает в свое распоряжение часть представлений о данных, но полная концепция скрыта. Отделение внешнего уровня от концептуального уровня обеспечивает логическую независимость данных;
2. **Промежуточный** (Концептуальный). В основе архитектуры ANSI/SPARC лежит концептуальный уровень. Этот уровень описывает данные и их взаимосвязи с наиболее общей точки зрения — концепции архитекторов (разработчиков) базы данных;
3. **Внутренний** (Физический) уровень позволяет скрыть подробности физического хранения данных (носители, файлы ...) от концептуального уровня. Отделение внутреннего уровня от концептуального уровня обеспечивает, так называемую, физическую независимость данных. [1]


![[Pasted image 20250304093423.png]]

На концептуальном уровне представлены следующие компоненты:

- Все сущности, атрибуты и связи;
- Накладываемые на данные ограничения;
- Семантическая информация о данных;
- Информация о мерах обеспечения безопасности и поддержки целостности данных.

## Модель "Сущность-Связь"

### Основные понятия

**Сущность** — любой различимый объект, факт, явление, событие, идея или предмет, информацию о котором необходимо хранить в базе данных. Сущностями могут быть люди, места, самолеты, рейсы, вкус, цвет, женитьба, гроза, изобретение, боль и т. п. Необходимо различать такие понятия, как тип сущности и экземпляр сущности. Понятие тип сущности относится к набору однородных личностей, предметов, событий или идей, выступающих как целое. Экземпляр сущности относится к конкретной вещи в наборе. Например, типом сущности может быть ГОРОД, а экземпляром — Москва, Киев и т. д.

**Атрибут** — поименованная характеристика (свойство) сущности. Это любая деталь, которая служит для уточнения, идентификации, классификации, числовой характеристики или выражения состояния сущности. Наименование атрибута должно быть уникальным для конкретного типа сущности, но может быть одинаковым для различного типа сущностей, например, ЦВЕТ может быть определен для многих сущностей: СОБАКА, АВТОМОБИЛЬ, ДЫМ и т. д. Атрибуты используются для определения того, какая информация должна быть собрана о сущности. Примерами атрибутов для сущности АВТОМОБИЛЬ являются ТИП, МАРКА, НОМЕРНОЙ ЗНАК, ЦВЕТ и т. д. Здесь также существует различие между типом и экземпляром. Тип атрибута ЦВЕТ имеет много экземпляров или значений (Красный, Синий, Банановый, Белая ночь и т. д.), однако каждому экземпляру сущности присваивается только одно значение атрибута.

Абсолютное различие между типами сущностей и атрибутами отсутствует. Атрибут является таковым только в связи с типом сущности. В другом контексте атрибут может выступать как самостоятельная сущность. Например, в расписании движения самолетов (см. рис. 1.1) город — это атрибут расписания, а в кодификаторе адресов город — тип сущности.

**Ключ** — минимальный набор атрибутов, по значениям которых можно однозначно найти требуемый экземпляр сущности. Минимальность означает, что исключение из набора любого атрибута не позволяет идентифицировать сущность по оставшимся. Для сущности Расписание (см. разд. 1.2) ключом является атрибут Номер_рейса или набор: Пункт_отправления, Время_вылета и Пункт_назначения (при условии, что из пункта в пункт вылетает в каждый момент времени один самолет).

![[Pasted image 20250304095350.png]]

**Связь** — ассоциирование двух или более сущностей. Абсолютное различие
между типами сущностей и связями отсутствует. Один и тот же факт может
совершенно обоснованно рассматриваться или как сущность, или как связь.
Например, в запросе — "с кем вступила в брак Алла Пугачева" брак — связь,
а в запросе — "сколько браков было зарегистрировано в этом ЗАГСе в про-
шлом году" брак — сущность.

**Цель инфологического моделирования** — обеспечение наиболее естественных для человека способов сбора и представления той информации, которую предполагается хранить в создаваемой базе данных. Поэтому инфологическую модель данных пытаются строить по аналогии с естественным языком (последний не может быть использован в чистом виде из-за сложности компьютерной обработки текстов и неоднозначности любого естественного языка). Основными конструктивными элементами инфологических моделей являются сущности, связи между ними и их свойства (атрибуты).

Если бы назначением базы данных было только хранение отдельных, не свя-
занных между собой данных, то ее структура могла бы быть очень простой.
Однако одно из основных требований к организации базы данных — это
обеспечение возможности отыскания одних сущностей по значениям других,
для чего необходимо установить между ними определенные связи. А так как
в реальных базах данных нередко содержатся сотни или даже тысячи сущно-
стей, то теоретически между ними может быть установлено более миллиона
связей. Наличие такого множества связей и определяет сложность инфологи-
ческих моделей.

### Характеристика связей и язык моделирования

При построении инфологических моделей можно использовать язык ER-
диаграмм — от англ. Entity-Relationship, т. е. сущность-связь. Этот язык был
предложен в 1976 году сотрудником корпорации IBM Питером Ченом. В нем предлагалось изображать сущности помеченными прямоугольника-
ми, связи — помеченными ромбами, атрибуты — помеченными овалами.
Над линиями, соединяющими прямоугольники, может проставляться сте-
пень связи (1 или буква М, заменяющая слово "много") и необходимое по-
яснение.

![[Pasted image 20250304095620.png]]

### Виды связей

Между двумя сущностями, например, А и Б возможны четыре вида связей.

1. Связь "один-к-одному" ) (1:1):  в каждый момент времени каж-
дому представителю (экземпляру) сущности А соответствует 1 или 0 пред-
ставителей сущности Б. Например, студент может не "заработать" стипен-
дию, получить обычную или одну из повышенных стипендий (рис. 2.2, а).

![[Pasted image 20250304095953.png]]

2. Связь "один-ко-многим" (1:М): одному представителю сущно-
сти А соответствуют 0, 1 или несколько представителей сущности Б. Напри-
мер, квартира может пустовать, в ней может жить один или несколько жиль-
цов (рис. 2.2, б).

![[Pasted image 20250304100048.png]]

3. Так как между двумя сущностями возможны связи в обоих направлениях, то
существует еще два типа связи "многие-к-одному" (М:1) и "многие-ко-
многим" (М:М).

![[Pasted image 20250304100209.png]]

### Ограничения целостности

**Целостность** (от англ. integrity — нетронутость, неприкосновенность, со-
хранность, целостность) — понимается как правильность данных в любой
момент времени. Но эта цель может быть достигнута лишь в определенных
пределах: СУБД не может контролировать правильность каждого отдельного
значения, вводимого в базу данных (хотя каждое значение можно проверить
на правдоподобность). Например, нельзя обнаружить, что вводимое значение
5 (представляющее номер дня недели) в действительности должно быть рав-
но 3. С другой стороны, значение 9 явно будет ошибочным и СУБД должна
его отвергнуть. Однако для этого ей следует сообщить, что номера дней не-
дели должны принадлежать набору (1,2,3,4,5,6,7).

![[Pasted image 20250304100915.png]]

Поддержание целостности базы данных может рассматриваться как защита данных от неверных изменений или разрушений (не путать с незаконными изменениями и разрушениями, являющимися проблемой безопасности). Современные СУБД имеют ряд средств для обеспечения поддержания целостности (так же, как и средств обеспечения поддержания безопасности).

Выделяют три группы правил целостности.

- **Целостность по сущностям.** Не допускается, чтобы какой-либо атрибут, участвующий в первичном ключе, принимал неопределенное значение.
- **Целостность по ссылкам.** Значение внешнего ключа должно либо:
	- быть равным значению первичного ключа ассоциируемой (характеризуемой) сущности;
	- быть полностью неопределенным, т. е. каждое значение атрибута, участвующего во внешнем ключе, должно быть неопределенным.
- **Целостность, определяемая пользователем**. Для любой конкретной базы данных существует ряд дополнительных специфических правил, которые относятся к ней одной и определяются разработчиком. Чаще всего контролируется:
	- уникальность тех или иных атрибутов;
	- диапазон значений (экзаменационная оценка от 2 до 5);
	- принадлежность набору значений (пол "М" или "Ж").

## Языки описания команд:

![[Pasted image 20250304104224.png]]

### Data Definition Language

**Язык определения данных (Data Definition Language (DDL))** - это группа команд, которые используются для создания и изменения структуры объектов базы данных: таблиц, представлений, схем и индексов.

Большинство пользователей работает с существующими базами данных
с помощью каких-либо приложений. Однако некоторым из них иногда требу-
ется создавать как сами базы данных, так и новые объекты в существующих
базах данных. Для этого необходимо познакомиться с языком определения
данных, с помощью которого можно:

- создать новую базу данных;
- создать так называемую схему в существующей базе данных;
- определить структуру новой таблицы и создать ее;
- удалить таблицу, которая больше не нужна;
- изменить определение существующей таблицы;
- создать индексы для ускорения доступа к таблицам;
- управлять физическим размещением данных;
- создать процедуру, функцию или триггер.

В большинстве случаев предложения DDL обеспечивают высокий уровень
доступа к данным и позволяют пользователю не вникать в детали хранения
информации в базе данных на физическом уровне. Они оперируют абстракт-
ными объектами базы данных, такими как таблицы и столбцы. Однако DDL не
может совершенно не затрагивать вопросов, связанных с физической памятью.

#### Команды

Инструкции и предложения DDL, управляющие физической памятью, могут
быть разными в различных СУБД. Ядро языка определения данных образуют
три глагола:
##### CREATE

Этот DDL-оператор создает объекты базы данных, например таблицы или представления.

```sql
CREATE TABLE IF NOT EXISTS table_name (
    user_id serial PRIMARY KEY,
    username VARCHAR( 50 ) NOT NULL,
    last_login TIMESTAMP
);
```

##### ALTER

Оператор применяется для модификации существующей структуры базы данных. Может добавить или удалить столбцы в таблице, изменить тип столбца, добавить ограничения и тому подобное. 

###### Примеры

Переименование таблицы с использованием команды:

```sql
ALTER TABLE old_table_name RENAME TO new_table_name;
```

Добавить колонку `password`:

```sql
ALTER TABLE example_table ADD COLUMN password TEXT;
```

Изменить колонку `counter` так, чтобы значения были уникальные и обязательны для заполнения:

```sql
ALTER TABLE example_table ALTER COLUMN counter SET NOT NULL UNIQUE;
```

Сделать в таблице первичный ключ `id`:

```sql
ALTER TABLE examle_table ADD PRIMARY KEY (id);
```

###### DELETE

Команду используют для удаления объектов из базы данных: таблицы, представления или индекса. Пример удаляет таблицу с именем my_table.

```sql	
DROP TABLE my_table;
```

#### Необязательные, но не менее полезные команды

##### TRUNCATE

Команда выполняет очистку таблицы в массовом порядке и отличается высокой скоростью. Она удаляет все строки, не позволяя указывать условия, и при этом не регистрирует каждое изменение в журнале. Помимо этого, **TRUNCATE** сбрасывает автоинкрементные счётчики, если таковые присутствуют в таблице. Используйте **TRUNCATE**, если вам необходимо быстро и полностью очистить таблицу:

```sql
TRUNCATE TABLE example_table;
```

В отличие от **TRUNCATE**, команда **DELETE** предоставляет гораздо большую гибкость: она позволяет выставлять ряд условий (**WHERE**) для удаления определенных строк, использовать откат операций и отслеживать каждое удаление. Этот вариант подходит для случаев, когда требуется контроль над процессом удаления:

### Data Manipulation Language

**Язык манипуляции данными (Data Manipulation Language (DML))** — это группа операторов, которые позволяют получать и изменять записи, присутствующие в таблице; подмножество языка  SQL, который используется для управления и манипулирования данными в реляционной базе данных. DML команды используются для вставки, обновления, удаления и извлечения данных из базы данных. Эти команды позволяют пользователям изменять данные, хранящиеся в базе данных, не затрагивая схему базы данных или определение объектов базы данных.

#### Команды
##### SELECT

Оператор SELECT используется для получения данных из одной или нескольких таблиц базы данных. Результатом оператора SELECT является таблица, также известная как набор результатов. Оператор SELECT также может использоваться для получения данных из нескольких таблиц с помощью операции объединения.

Например, эта инструкция используется для получения кортежей из таблицы.

```sql
SELECT user_id, username FROM table_name;
```

##### INSERT

Оператор INSERT используется для вставки новых строк данных в таблицу. Оператор INSERT можно использовать для вставки данных в одну или несколько таблиц одновременно.

Это ключевое слово применяют для добавления новых записей в таблицу.

```sql
INSERT INTO table_name(user_id, username, last_login) VALUES(1, 'Ivan Petrov', NULL);
```

##### DELETE

DML-команда позволяет удалить одну или несколько записей.

```sql
DELETE FROM table_name WHERE username = 'nick';
```

##### UPDATE

Оператор используется для изменения существующих данных в таблице

```sql
UPDATE table_name SET username = 'newnick' WHERE user_id = 1;
```

## Источники
1. В. Кириллов, Г. Громов "Введение в реляционные базы данных", Санкт-Петербург, 2009
2. Файловый архив студентов StudFiles https://studfile.net/preview/9138111/